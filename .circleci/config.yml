version: 2.1

orbs:
  helm: circleci/helm@0.1.2

jobs:
  lint:
    docker:
      - image: debian:stretch
    steps:
      - checkout
      - helm lint ./helm/charts/ory-oathkeeper/

  release:
    docker:
      - image: debian:stretch
    steps:
      - checkout
      - helm package -d docs/ ./helm/charts/ory-oathkeeper/ --version `echo $CIRCLE_TAG | sed s/v//g`
      - helm repo index docs/

workflows:
  lint:
    jobs:
      - lint
  release:
    jobs:
      - release
    requires:
      - lint
    filters:
      tags:
        only: /.*/
